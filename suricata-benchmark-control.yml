
- name: Reboot to Defaults. Run "{{ansible_loop.index}}" of "{{ansible_loop.revindex}}"
  reboot:
  become: yes
  tags: reboot

- debug:
      msg: "CPU count for {{ ansible_hostname }} is {{ ansible_facts['processor_count'] }}"
- debug:
      var: ansible_facts['memory_mb']['nocache']['free']

- name: Copy Performance Monitor
  copy:
    src: gather_stats.bash
    dest: "{{sensor_dir}}/gather_stats.bash"
    mode: '0755'

- name: Copy Latest suricata.yaml Configs
  copy:
    src: suricata.yaml
    dest: "{{sensor_dir}}/suricata.yaml"
    mode: '0777'

- name: Set Static Controls
  include_tasks: static-controls.yml

- name: Set Variable Factor Controls
  include_tasks: variable-controls.yml


  #-run replicates
- name: Begin Suricata IDS Benchmark
  include_tasks: suricata-benchmark-tasks.yml
  loop: "{{ replicates }}"
  loop_control:
    extended: yes
    loop_var: inner_counter
    index_var: inner_idx
